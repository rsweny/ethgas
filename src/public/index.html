<!DOCTYPE html>
<html lang="en">
<head>
	<title>Average ETH Gas Cost</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta charset="UTF-8"/>
	<meta name="description" content="Historical ETH gas prices with averge hourly breakdown"/>
	<style>
		body {
			color: white;
			font-size: 0.8rem;
			font-family: Arial, Helvetica, sans-serif;
		}

		a {
			color:white;
		}

		.root {
			display: flex;
			flex-direction: row;
			justify-content: initial;
		}

		.day-header {
			padding: 0.2rem 0px;
			box-sizing: border-box;
			flex: 1 1 14.285%;
			overflow: hidden;
			width: 14.2857%;
		}

		.time-header {
			box-sizing: border-box;
			padding: 0px 0.2rem;
			line-height: 1.5rem;
		}

		.entry {
			border-width: 1px 1px 0px 0px;
			border-style: initial;
			border-color: initial;
			border-image: initial;
			text-align: center;
			overflow: hidden;
			box-sizing: border-box;
			flex: 1 0 0px;
			height: 1.5rem;
			line-height: 1.5rem;
			border-radius: 0px;
		}

		.year-entry {
			flex: 0 1 3.1%;
			min-width: 24px;
			text-align: center;
			color: white;
			line-height: 1.5rem;
			height: 1.5rem;
			cursor: pointer;
			font-size: 10px;
		}

		.year-entry:hover {
			opacity: 60%;
		}

		.blend {
			opacity: 60%;	
		}

		.month-header {
			flex: 1 1 3.225%;
			width: 3.225%;
			min-width: 24px;
			text-align: left;
			line-height: 1.5rem;
			height: 1.5rem;
		}

		.gasRow {
			display: flex;
			flex-direction: row;
			justify-content: initial;
		}

		.gasRow:hover {
			opacity: 60%;
		}

		#lastUpdate {
			color: grey;
			margin: 20px;
			font-size: 10px;
		}
	</style>

	<!-- generated datasets, see deploy-s3 lambda -->
	<script type="text/javascript" src="gasdata.js"></script>
	<script type="text/javascript" src="gasyeardata2021.js"></script>
	<script type="text/javascript" src="gasyeardata2022.js"></script>
	<script type="text/javascript" src="gasyeardata2023.js"></script>

	<script>
		const EIP1559_START_INDEX = 221;
		gasYearData[2020] = {};
		const patchData2020 = [12,11,11,10,10,11,10,11,11,12,11,11,11,16,11,10,11,11,10,10,10,10,9,8,8,7,9,8,9,9,9,9,9,10,12,12,13,13,12,11,11,11,13,13,13,13,13,12,11,12,12,9,10,13,12,12,14,12,12,10,,,10,10,11,11,12,11,11,13,14,12,13,78,85,17,14,30,19,16,18,16,12,13,14,14,14,13,13,11,11,12,13,12,13,13,11,10,14,13,12,12,12,11,10,12,12,12,15,12,13,12,14,14,14,14,14,13,13,14,13,18,24,,14,11,13,15,16,18,21,21,18,31,24,27,33,41,32,25,27,37,33,37,49,35,22,29,38,38,43,40,35,34,28,32,37,30,32,32,39,41,42,37,582,710,36,29,24,43,41,42,38,39,30,30,41,45,47,43,38,37,35,40,52,,47,43,45,33,32,40,41,52,47,39,34,32,51,44,52,56,58,51,55,71,76,72,82,76,82,73,97,72,74,72,79,64,80,70,60,55,60,75,68,78,118,130,224,264,215,121,103,116,133,138,116,162,107,86,99,111,93,98,93,103,212,236,446,480,391,232,277,129,113,104,120,179,147,107,121,200,187,153,538,319,174,133,177,159,129,109,103,84,86,122,154,120,,101,94,80,83,91,109,86,87,80,64,50,76,75,76,74,63,36,40,57,62,74,63,58,32,33,56,43,65,69,63,41,34,60,45,37,50,60,56,29,43,50,52,58,55,35,35,48,75,80,47,68,66,63,77,94,61,143,45,35,31,79,,87,44,47,54,37,36,50,64,65,56,64,43,45,64,85,84,139,74,70,45,80,67,108,90,92,66,99,114,96,114,99];
		const patchData2021 = [67,103,170,259,138,125,133,140,93,87,238,87,68,85,94,81,64,75,101,84,121,132,80,81,108,85,100,95,141,113,129,154,176,173,233,252,180,160,213,234,213,175,180,189,150,179,173,173,183,186,202,145,273,374,210,165,158,118,118,,,,119,125,131,113,138,99,132,137,140,134,132,172,163,149,189,189,194,178,159,141,138,188,164,177,179,145,119,124,150,167,211,192,186,146,112,149,153,154,124,119,98,85,109,120,138,105,184,145,170,196,266,166,140,124,68,55,63,67,79,72,57,,60,43,67,69,59,66,68,140,131,238,299,282,171,129,93,81,95,88,299,127,115,56,144,68,52,50,39,41,33,28,32,30,32,34,29,22,19,25,33,28,24,26,23,18,23,23,23,25,24,19,21,47,73,25,22,28,19,26,24,26,32,,25,21,19,16,20,55,40,37,30,19,16,30,32,46,45,42,30,30,30,35,27,33,35,25,23,42,41,47,34,39,44,40,44,49,46,64,54,54,51,62,65,67,59,63,54,63,61,57,54,52,48,40,41,68,87,102,98,121,89,101,114,121,136,117,159,127,116,124,214,157,152,107,71,66,107,74,75,89,81,58,65,94,107,74,91,79,51,71,138,95,84,107,,93,69,66,106,130,150,152,126,85,86,114,98,109,139,153,91,81,113,80,87,100,92,72,80,104,132,177,198,184,171,157,167,184,171,153,141,118,104,133,181];
		const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
		const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
		let today = new Date();
		let dayOfWeek = dayNames[today.getUTCDay()];

		function populateWeekChart() {
			let hours = '';
			let avgHours = '';
			let gas = '';
			let days = '';
			for (let i = 0; i < 24; i++) {
				hours += `<div class="time-header">${i}:00</div>`;
				gas += `<div class="gasRow">`;
				const timeObj = { a: 0, h: 0, l: 0, f: 0 };
				for (let j = 0; j < 7; j++) {
					const obj = gasData[i][j];
					const lbl = obj.h > 0 ? obj.a : "";
					const title = `high: ${obj.h},  low: ${obj.l},  tip: ${obj.f}`;
					const { red, green, blue, alpha } = getRGBA(obj);
					timeObj.a += obj.a/7;
					timeObj.h += obj.h/7;
					timeObj.l += obj.l/7;
					timeObj.f += obj.f/7;
					gas += `<div title="${title}" class="entry" style="background: rgba(${red}, ${green}, ${blue}, ${alpha}">${lbl}</div>`;
				}
				gas += `</div>`;
				const { red, green, blue, alpha } = getRGBA(timeObj);
				const tTitle = `avg: ${Math.round(timeObj.a)} h: ${Math.round(timeObj.h)} l: ${Math.round(timeObj.l)} tip: ${Math.round(timeObj.f)}`;
				avgHours += `<div class="time-header" title="${tTitle}" style="width: 70px; background-image: linear-gradient(to right, rgba(${red}, ${green}, ${blue}, 0.1), rgba(${red}, ${green}, ${blue}, ${alpha}));">${i}:00</div>`;
			}

			for (let daysAgo = 6; daysAgo >= 0; daysAgo--) {
				const dayIndex = (today.getUTCDay() - daysAgo + 7) % 7;
				const dayOfWeek = dayNames[dayIndex];
				days += `<div class="day-header">${dayOfWeek}</div>`;
			}
			document.getElementById('hoursHeader').innerHTML = avgHours;
			document.getElementById('dateHoursHeader2021').innerHTML = hours;
			document.getElementById('dateHoursHeader2022').innerHTML = hours;
			document.getElementById('daysHeader').innerHTML = days;
			document.getElementById('gasData').innerHTML = gas;
			document.getElementById('lastUpdate').innerHTML = `Updates every 10 minutes, last update: ${gasData.lastUpdated.substring(0,16)}  <br/>
			<br/>
			<a href="https://github.com/rsweny/ethgas" style="padding-top: 12px; text-decoration: none">
				<svg width="24" height="24" fill="#FFF" aria-hidden="true" viewBox="0 0 24 24" version="1.1" data-view-component="true" class="octicon octicon-mark-github">
			    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
				</svg>
			</a><br/>
			<a href='https://etherscan.io/gastracker'>etherscan.io</a><p/>`;
		}

		function populateYearChart(yr) {
			const yearData = gasYearData[yr];
			if (!yearData) {
				document.getElementById('history'+yr).style.display = "none";
				return;
			}

			let yearDays = '';
			let count = 0;
			for (let month = 1; month <= 12; month++) {
				yearDays += `<div style="display: flex; flex-grow: 1; flex-wrap: wrap; width: 100%"><div class="month-header">${monthNames[month-1]}</div>`;
				
				if (!yearData[month]) yearData[month] = {};
				for (let i = 1; i <= 31; i++)
				{
					const obj = yearData[month][i];
					if (obj) {
						const dayOfWeek = dayNames[(new Date(obj.d + 'T12:00:00.000Z')).getDay()];
						const lbl = obj.h > 0 ? obj.a : "";
						const { red, green, blue, alpha } = getRGBA(obj);
						const title = `${dayOfWeek} ${obj.d} | high: ${obj.h},  low: ${obj.l},  tip: ${obj.f}`;
						const dark = (red+green+blue)*alpha > 500 ? 'style="color: #222"' : '';
						yearDays += `<div onclick="dayClick('${obj.d}')" title="${title}" class="year-entry" style="background: rgba(${red}, ${green}, ${blue}, ${alpha}"><span class="blend" ${dark}>${lbl}</span></div>`;
					} else {
						if (yr == 2021 && count < patchData2021.length && patchData2021[count]) {
							const avg = patchData2021[count];
							const f = count > EIP1559_START_INDEX ? 1 : avg;
							const l = count > EIP1559_START_INDEX ? Math.round(avg / 1.5) : Math.round(avg / 3);
							const h = count > EIP1559_START_INDEX ? Math.round(avg * 4) : Math.round(avg * 1.5);
							const { red, green, blue, alpha } = getRGBA({ a: avg, l: count == EIP1559_START_INDEX ? 1 : l, h, f});
							yearDays += `<div class="year-entry" style="background: rgba(${red}, ${green}, ${blue}, ${alpha}"><span class="blend">${avg}</span></div>`;
						} 
						else if (yr == 2020 && count < patchData2020.length && patchData2020[count]) {
							const avg = patchData2020[count];
							const l = Math.round(avg / 3);
							const h = Math.round(avg * 1.5);
							const { red, green, blue, alpha } = getRGBA({ a: avg, l, h, f:avg});
							yearDays += `<div class="year-entry" style="background: rgba(${red}, ${green}, ${blue}, ${alpha}"><span class="blend">${avg}</span></div>`;
						}
						else {
							yearDays += '<div class="year-entry"></div>';
						}
						count++;
					}
				}
				
				yearDays += '</div>';
			}
			document.getElementById('yearData'+yr).innerHTML = yearDays;
		}

		async function dayClick(day) {
			console.log(day);
			try {
				const year = day.substring(0,4);
				const response = await fetch(`${year}/${day}.json`);
	  			const dayData = await response.json();
	  			console.log(dayData);
	  			let dayStr = "";
				for (let i = 0; i < 24; i++) {
					dayStr += `<div style="display: flex; flex-direction: row; justify-content: initial;">`;
					const obj = dayData[i];
					const lbl = obj.h > 0 ? obj.a : "";
					const { red, green, blue, alpha } = getRGBA(obj);
					const title = `${day} | high: ${obj.h},  low: ${obj.l},  tip: ${obj.f}`;
					dayStr += `<div title="${title}" class="entry" style="background: rgba(${red}, ${green}, ${blue}, ${alpha}">${lbl}</div>`;
					dayStr += `</div>`;
				}
				document.getElementById('dayData'+year).innerHTML = dayStr;
				document.getElementById('dayPanel'+year).style.opacity = 1.0;
			} catch(e) {
				console.log(e);
			}
		}

		function getRGBA(obj) {
			const red = Math.round(Math.min(255, Math.sqrt(obj.h)*8));
			const green = Math.max(255 - obj.l*3, 0);
			const blue = Math.round(Math.min(obj.f*9, 255));
			const alpha = Math.min(Math.round(Math.pow(obj.a,0.7)*8)/500, 1);
			return { red, green, blue, alpha };
		}

		window.onload = function() {
			populateWeekChart();
			populateYearChart(2023);
			populateYearChart(2022);
			populateYearChart(2021);
			populateYearChart(2020);
        }
	</script>

</head>
<body bgcolor="#000" style="margin: 5px 7% 5px 7%;">

<center><h2>Eth Gas Past Week (Gwei)</h2><small id="lastUpdate"></small></center>

<div class="root">
	<div style="margin-bottom: 21px;">
		<div id="hoursHeader" style="display: flex; flex-direction: column; text-align: right;">
		</div>
	</div>

	<div style="display: flex; flex-direction: column-reverse; flex-grow: 1;">
		<div>
			<div id="daysHeader"style="display: flex; text-align: center;">
			</div>
		</div>
		<div id="gasData" style="display: flex; flex-direction: column; flex-grow: 0;">
		</div>
	</div>
</div>

<div id="history2023" style="display: flex; flex-direction: row; flex-grow: 1;">
	<div style="flex: 1 1 90%">
		<div>
			<center><h2 style="margin-top: 45px">Eth Gas Price History 2023</h2></center>
			<div id="yearData2023"></div>
		</div>
	</div>
	<div id="dayPanel2023" style="flex: 1 1 10%; opacity: 0">
		<div>
			<center><h2 style="margin-top: 45px">Hourly Breakdown</h2></center>
				
			<div class="root">
				<div style="margin-bottom: 21px;">
					<div id="dateHoursHeader2023" style="display: flex; flex-direction: column; text-align: right;">
					</div>
				</div>

				<div id="dayData2023" style="display: flex; flex-direction: column; width: 100%">
				</div>
			</div>

		</div>
	</div>
</div>

<div id="history2022" style="display: flex; flex-direction: row; flex-grow: 1;">
	<div style="flex: 1 1 90%">
		<div>
			<center><h2 style="margin-top: 45px">Eth Gas Price History 2022</h2></center>
			<div id="yearData2022"></div>
		</div>
	</div>
	<div id="dayPanel2022" style="flex: 1 1 10%; opacity: 0">
		<div>
			<center><h2 style="margin-top: 45px">Hourly Breakdown</h2></center>
				
			<div class="root">
				<div style="margin-bottom: 21px;">
					<div id="dateHoursHeader2022" style="display: flex; flex-direction: column; text-align: right;">
					</div>
				</div>

				<div id="dayData2022" style="display: flex; flex-direction: column; width: 100%">
				</div>
			</div>

		</div>
	</div>
</div>

<div id="history2021" style="display: flex; flex-direction: row; flex-grow: 1;">
	<div style="flex: 1 1 90%">
		<div>
			<center><h2 style="margin-top: 45px">Eth Gas Price History 2021</h2></center>
			<div id="yearData2021"></div>
		</div>
	</div>
	<div id="dayPanel2021" style="flex: 1 1 10%; opacity: 0">
		<div>
			<center><h2 style="margin-top: 45px">Hourly Breakdown</h2></center>
				
			<div class="root">
				<div style="margin-bottom: 21px;">
					<div id="dateHoursHeader2021" style="display: flex; flex-direction: column; text-align: right;">
					</div>
				</div>

				<div id="dayData2021" style="display: flex; flex-direction: column; width: 100%">
				</div>
			</div>

		</div>
	</div>
</div>

<div id="history2020" style="display: flex; flex-direction: row; flex-grow: 1;">
	<div style="flex: 1 1 90%">
		<div>
			<center><h2 style="margin-top: 45px">Eth Gas Price History 2020</h2></center>
			<div id="yearData2020"></div>
		</div>
	</div>
	<div id="dayPanel2020" style="flex: 1 1 10%; opacity: 0">
		<div>
			<center><h2 style="margin-top: 45px">Hourly Breakdown</h2></center>
				
			<div class="root">
				<div style="margin-bottom: 21px;">
					<div id="dateHoursHeader2020" style="display: flex; flex-direction: column; text-align: right;">
					</div>
				</div>

				<div id="dayData2020" style="display: flex; flex-direction: column; width: 100%">
				</div>
			</div>

		</div>
	</div>
</div>

</body>
</html>
